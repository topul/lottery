(function(t){function e(e){for(var a,o,s=e[0],c=e[1],l=e[2],g=0,u=[];g<s.length;g++)o=s[g],n[o]&&u.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);d&&d(e);while(u.length)u.shift()();return i.push.apply(i,l||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],a=!0,s=1;s<r.length;s++){var c=r[s];0!==n[c]&&(a=!1)}a&&(i.splice(e--,1),t=o(o.s=r[0]))}return t}var a={},n={1:0},i=[];function o(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=a,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(r,a,function(e){return t[e]}.bind(null,a));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var l=0;l<s.length;l++)e(s[l]);var d=c;i.push([2,0]),r()})({2:function(t,e,r){t.exports=r("Vtdi")},"4Ktl":function(t,e,r){},EDI0:function(t,e,r){},V0tE:function(t,e,r){"use strict";var a=r("4Ktl"),n=r.n(a);n.a},Vtdi:function(t,e,r){"use strict";r.r(e);r("VRzm");var a=r("Kw5r"),n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("v-lottery",{attrs:{data:t.awardsData},on:{onstart:t.startRotation,onstop:t.stopRotation}})],1)},i=[],o={name:"app",data:function(){return{awardsData:{data:[{title:"奖品一",color:"#fe807d",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"},{title:"奖品二",color:"#fe7771",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"},{title:"奖品三",color:"#fe807d",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"},{title:"谢谢参与",color:"#fe7771",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"},{title:"奖品四",color:"#fe807d",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"},{title:"奖品五",color:"#fe7771",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"},{title:"奖品六",color:"#fe807d",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"},{title:"谢谢参与",color:"#fe7771",src:"http://img13.360buyimg.com/n1/g7/M03/11/16/rBEHZlDdcgAIAAAAAAETXb0oTNQAADdPwG-jPIAARN1548.jpg"}],target:"",bgColor:"#ff5859",width:400,height:400}}},methods:{startRotation:function(){var t=this;this.awardsData.target="",setTimeout(function(){t.awardsData.target="奖品四"},1e3)},stopRotation:function(){console.log("stopRotation")}}},s=o,c=(r("ZL7j"),r("KHd+")),l=Object(c["a"])(s,n,i,!1,null,null,null),d=l.exports,g=(r("f3/d"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lottery",style:{backgroundColor:t.mergedData.bgColor,width:t.mergedData.width+"px",height:t.mergedData.height+"px"}},[a("div",{staticClass:"turntable"}),a("canvas",{attrs:{id:"canvas",width:t.mergedData.width,height:t.mergedData.height}}),a("img",{staticClass:"lottery-go",attrs:{src:r("cwHT")(t.mergedData.dotImage)},on:{click:function(e){return e.stopPropagation(),t.startRotation(e)}}})])}),u=[],h=(r("INYr"),r("bHtr"),r("rGqo"),r("yT7P")),f={name:"v-lottery",props:{data:{type:Object,required:!0,default:function(){}}},data:function(){return{startAngle:0,flag:!1,piece:0,rotateDeg:0,defaultData:{data:[],target:"",bgColor:"#ff5859",dotImage:"./assets/dot.png",width:300,height:300}}},computed:{outsideRadius:function(){return 13*this.mergedData.width/30},textRadius:function(){return.35*this.mergedData.width},mergedData:function(){return Object(h["a"])({},this.defaultData,this.data)}},mounted:function(){var t=this;this.drawLottery(),this.$watch("mergedData.target",function(){if(t.mergedData.target){t._processTime=(new Date).getTime();var e=Math.floor((t._processTime-t._startTime)/1e3),r=e<2?2:0;setTimeout(function(){t.stopRotation()},1e3*r)}});document.getElementById("canvas")},methods:{reset:function(){this.startAngle=0,this.rotateDeg=0},drawLottery:function(){var t=this,e=document.getElementById("canvas"),r=e.getContext("2d");this.ctx=r;var a=[this.mergedData.width,this.mergedData.height,this.mergedData.width/2,this.mergedData.height/2],n=a[0],i=a[1],o=a[2],s=a[3];this.centerX=o,this.centerY=s;var c=Math.PI/(this.mergedData.data.length/2);this.piece=c,r.clearRect(0,0,n,i),r.strokeStyle="#e95455",r.font="16px Microsoft YaHei",this.mergedData.data.forEach(function(e,a){var n=t.startAngle+a*c;r.fillStyle=e.color||"#ef8781",r.beginPath(),r.moveTo(o,s),r.arc(o,s,t.outsideRadius,n,n+c,!1),r.closePath(),r.fill(),r.stroke(),r.save(),t.drawTitle(e,n,c),e.src&&t.drawImage(e,n,c)})},resetCoordinate:function(t,e){var r=this.ctx,a=this.centerX+Math.cos(t+e/2)*this.textRadius,n=this.centerY+Math.sin(t+e/2)*this.textRadius;r.translate(a,n),r.rotate(t+e/2+Math.PI/2)},drawTitle:function(t,e,r){var a=this.ctx;a.fillStyle="#fff",this.resetCoordinate(e,r),a.fillText(t.title,-a.measureText(t.title).width/2,0),a.restore(),a.save()},preImage:function(t,e,r){var a=new Image;a.src=t,a.complete?e.call(a,r.x,r.y,r.width,r.height):a.onload=function(){e.call(a,r.x,r.y,r.width,r.height)}},drawImage:function(t,e,r){var a=this.ctx,n=this;this.preImage(t.src,function(t,i,o,s){a.save(),n.resetCoordinate(e,r),a.drawImage(this,-20,10,40,30),a.restore()},{x:-20,y:10,width:40,height:30})},getTargetAngel:function(){var t=this,e=this.mergedData.data.findIndex(function(e){return e.title===t.mergedData.target});return-1!==e?this.piece*(e+.5)*180/Math.PI:360},startRotation:function(){if(!this.flag){this.$emit("onstart");var t=document.getElementById("canvas");t.style.transition="all 30s ease-in",t.style.transform="rotate(54000deg)",t.style.webkitTransform="rotate(54000deg)",this._startTime=(new Date).getTime(),this.flag=!0}},stopRotation:function(){var t=this,e=this.getTargetAngel(),r=document.getElementById("canvas");r.style.transition="all 4s cubic-bezier(0.39, 0.575, 0.565, 1)",this._endTime=(new Date).getTime(),this.rotateDeg+=270-e+(360-this.rotateDeg%360)+1800*Math.floor((this._endTime-this._startTime)/1e3),r.style.transform="rotate(".concat(this.rotateDeg,"deg)"),r.style.webkitTransform="rotate(".concat(this.rotateDeg,"deg)"),setTimeout(function(){t.flag=!1,t.$emit("onstop")},3e3)}}},m=f,A=(r("V0tE"),Object(c["a"])(m,g,u,!1,null,"f8877d62",null)),p=A.exports;p.install=function(t){t.component(p.name,p)};var w=p;a["a"].config.productionTip=!1,a["a"].use(w),new a["a"]({render:function(t){return t(d)}}).$mount("#app")},ZL7j:function(t,e,r){"use strict";var a=r("EDI0"),n=r.n(a);n.a},cwHT:function(t,e){function r(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}r.keys=function(){return[]},r.resolve=r,t.exports=r,r.id="cwHT"}});
//# sourceMappingURL=app.800c382a.js.map